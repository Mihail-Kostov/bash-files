## ┌──────────────────────────────────────────────────────────────────────────┐
## │ ____           _____ _    _            ______ _____ _      ______  _____ │
## │|  _ \   /\    / ____| |  | |          |  ____|_   _| |    |  ____|/ ____|│
## │| |_) | /  \  | (___ | |__| |  ______  | |__    | | | |    | |__  | (___  │
## │|  _ < / /\ \  \___ \|  __  | |______| |  __|   | | | |    |  __|  \___ \ │
## │| |_) / ____ \ ____) | |  | |          | |     _| |_| |____| |____ ____) |│
## │|____/_/    \_\_____/|_|  |_|          |_|    |_____|______|______|_____/ │
## │                                                                          │
## └──────────────────────────────────────────────────────────────────────────┘
##  ------------------------------------------------------------------------  ##
##                               SSH-Agent Runner                             ##
##  ------------------------------------------------------------------------  ##

SSH_ENV=$HOME/.ssh/environment

##
##  Start the ssh-agent
##
function start_agent {
  printf "\nInitializing new SSH agent ... "
  # spawn ssh-agent
  /usr/bin/ssh-agent | sed 's/^echo/#echo/' > "${SSH_ENV}"
  echo succeeded
  chmod 600 "${SSH_ENV}"
  . "${SSH_ENV}" > /dev/null
  /usr/bin/ssh-add
}

if [ -f "${SSH_ENV}" ]; then
  . "${SSH_ENV}" > /dev/null
  ps -ef | grep ${SSH_AGENT_PID} | grep ssh-agent$ > /dev/null || {
    start_agent;
  }
else
  start_agent;
fi
